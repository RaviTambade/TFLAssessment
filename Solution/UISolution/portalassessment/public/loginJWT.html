<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Login</title>

  <!-- Tailwind CDN -->
  <script src="./Script/Tailwind.min.js"></script>

  <!-- jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Segoe UI', 'sans-serif']
          }
        }
      }
    }
  </script>
</head>

<body class="h-screen flex justify-center items-center font-sans">

  <div class="bg-white p-10 rounded-xl shadow-2xl w-full max-w-sm">
    <h2 class="text-2xl font-bold text-center mb-8 text-black">Login</h2>

    <form id="loginForm" class="space-y-4">
      <div>
        <label class="font-semibold text-black">Email:</label>
        <input type="email" id="email" required
          class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-400 focus:outline-none text-sm" />
      </div>

      <div>
        <label class="font-semibold text-black">Password:</label>
        <input type="password" id="password" required
          class="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-400 focus:outline-none text-sm" />
      </div>

      <button type="submit"
        class="w-full bg-[#7870d2] hover:bg-[#5c55a4] text-white py-2 rounded-lg font-bold transition">
        Login
      </button>
    </form>

    <p id="error" class="text-center text-red-600 mt-4"></p>
  </div>

  <script>
    $(document).ready(function () {
      $("#loginForm").submit(function (e) {
        e.preventDefault();

        const loginData = {
          email: $("#email").val(),
          password: $("#password").val()
        };

        $.ajax({
          url: "http://localhost:5238/api/Auth/login",
          type: "POST",
          contentType: "application/json",
          data: JSON.stringify(loginData),

          success: function (response) {
            console.log("responseresponseresponse:", response);

            const token = response.token;
            const user = response.user;
            const role = user.userRoles[0].role.name.toLowerCase();

            if (!user.id) {
              $("#error").text("User ID is missing in the response.");
              return;
            }

            localStorage.setItem("token", token);
            localStorage.setItem("userId", user.id);
            localStorage.setItem("userEmail", user.email);
            localStorage.setItem("role", role);

            if (role === "admin") {
              window.location.href = "Admin/admin.html";
            } else if (role === "sme") {
              window.location.href = "SME/sme.html";
            } else if (role === "student") {
              window.location.href = "Student/student.html";
            } else {
              $("#error").text("Role not recognized.");
            }
          },

          error: function () {
            $("#error").text("Invalid email or password.");
          }
        });
      });
    });
  </script>

</body>

</html>
