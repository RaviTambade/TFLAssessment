<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subject Question Bank</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>

  <body>
    <div class="container mt-6 mt-5">
      <h2 class="text-center mb-4">Subject Question Bank</h2>

      <div
        id="subjectsTabs"
        class="subject-tabs mb-4 flex gap-3 overflow-x-auto py-2 whitespace-nowrap"
      ></div>

      <h4 id="subjectTitle" class="mb-3 text-primary fw-bold">
        Select a subject
      </h4>
      <div id="questionList"></div>
    </div>

    <script>
    
      SUBJECT_API = "http://localhost:5238/api/QuestionBank/questionCount";

      $(document).ready(function () {
        loadSubjects();
      });

      function loadSubjects() {
        $.ajax({
          url: SUBJECT_API,
          method: "GET",
          success: function (subjects) {
            $("#subjectsTabs").empty();

            subjects.forEach((sub) => {
              let tab = $(`
                    <div class="subject-tab cursor-pointer px-4 py-2 rounded-full bg-[#e9ecef] text-[15px] font-medium transition hover:bg-[#d1dce4]">
                        ${sub.subject.title} (${sub.questionCount})
                    </div>
                `);

              tab.click(function () {
                $(".subject-tab")
                  .removeClass("bg-[#0d6efd] text-white")
                  .addClass("bg-[#e9ecef] text-black");

                $(this)
                  .removeClass("bg-[#e9ecef] text-black")
                  .addClass("bg-[#0d6efd] text-white");

                loadQuestions(sub.subject.id, sub.subject.title);
              });

              $("#subjectsTabs").append(tab);
            });
          },
          error: function () {
            alert("Failed to load subjects");
          },
        });
      }

      function loadQuestions(subjectId, subjectName) {
        QUESTION_API = `http://localhost:5238/api/questionbank/questions/subjects/${subjectId}`;

        $.ajax({
          url: QUESTION_API,
          method: "GET",
          success: function (questions) {
            $("#subjectTitle").text(`${subjectName} - Question Bank`);
            $("#questionList").empty();

            if (!questions || questions.length === 0) {
              $("#questionList").html("<p>No questions available.</p>");
              return;
            }

            let i = 1;
            questions.forEach((q) => {
              let card = $(`
                    <div class="question-card p-3 rounded-lg bg-white shadow-md mb-2 cursor-pointer" onclick="QuestionDisplay(${q.questionId})">
                        <strong>Q ${i}: ${q.question}</strong>
                    </div>
                `);
              i++;

              $("#questionList").append(card);
            });
          },
          error: function () {
            alert("Failed to load question bank");
          },
        });
      }

      function QuestionDisplay(questionId) {
        $("#content").load("QuestionDetails.html", function () {
          QuestionDetails(questionId);
        });
      }
    </script>
  </body>
</html>
