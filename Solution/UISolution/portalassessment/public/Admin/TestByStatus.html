<!DOCTYPE html>
<html>
<head>
    <title>Test Status Dashboard</title>

    <script src="../Script/Tailwind.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body class="p-4 font-sans">

    <h2 class="mb-4 text-2xl font-bold">DASHBOARD</h2>

    <!-- CARDS -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

        <!-- Created Test -->
        <div class="rounded-xl p-6 text-white shadow-lg cursor-pointer transition-transform duration-300 hover:scale-[1.03]"
             style="background:#198754;" onclick="LoadCreatedTest()">
            <div class="text-lg font-semibold">Test Created</div>
            <div id="Createdtest" class="text-5xl font-bold text-center">0</div>
        </div>

        <!-- Scheduled Test -->
        <div class="rounded-xl p-6 text-white shadow-lg cursor-pointer transition-transform duration-300 hover:scale-[1.03]"
             style="background:#0d6efd;" onclick="LoadScheduledTest()">
            <div class="text-lg font-semibold">Test Scheduled</div>
            <div id="Scheduledtest" class="text-5xl font-bold text-center">0</div>
        </div>

        <!-- Cancelled Test -->
        <div class="rounded-xl p-6 text-white shadow-lg cursor-pointer transition-transform duration-300 hover:scale-[1.03]"
             style="background:#fd9d0d;" onclick="loadCancelledTest()">
            <div class="text-lg font-semibold">Test Cancelled</div>
            <div id="Cancelledtest" class="text-5xl font-bold text-center">0</div>
        </div>

    </div>

    <hr class="my-10">

    <!-- TABLE -->
    <h3 id="heading" class="text-xl font-semibold">Created Test</h3>

    <div class="overflow-x-auto mt-4">
        <table class="min-w-full border border-gray-300 rounded-lg overflow-hidden shadow">
            <thead class="bg-gray-900 text-white">
                <tr>
                    <th class="p-3 text-left border border-gray-700">Name</th>
                    <th class="p-3 text-left border border-gray-700">Subject</th>
                    <th class="p-3 text-left border border-gray-700">Duration</th>
                    <th class="p-3 text-left border border-gray-700">Start date</th>
                    <th class="p-3 text-left border border-gray-700">End date</th>
                </tr>
            </thead>
            <tbody id="topTenTable" class="bg-white"></tbody>
        </table>
    </div>

    <hr class="my-10">

<script>
API = "http://localhost:5238/api/assessment";

$(document).ready(function () {
    loadDashboard();
    LoadCreatedTest();

    setInterval(() => {
        loadDashboard();
    }, 3000);
});

// Dashboard Cards
function loadDashboard() {
    $.ajax({
        url: API + "/testcount/created",
        method: "GET",
        success: function (data) {
            $("#Createdtest").text(data);
        }
    });

    $.ajax({
        url: API + "/testcount/scheduled",
        method: "GET",
        success: function (data) {
            $("#Scheduledtest").text(data);
        }
    });

    $.ajax({
        url: API + "/testcount/cancelled",
        method: "GET",
        success: function (data) {
            $("#Cancelledtest").text(data);
        }
    });
}

// Load Created Test
function LoadCreatedTest() {
    $.ajax({
        url: API + "/alltest/created",
        method: "GET",
        success: function (data) {

            $("#heading").text("Created Test");
            $("#topTenTable").empty();

            data.forEach(test => {
                $("#topTenTable").append(`
                    <tr class="border-b">
                        <td class="p-3">${test.testName}</td>
                        <td class="p-3">${test.subjectname}</td>
                        <td class="p-3">${test.duration}</td>
                        <td class="p-3">${test.scheduledStart}</td>
                        <td class="p-3">${test.scheduledEnd}</td>
                    </tr>
                `);
            });
        }
    });
}

// Load Scheduled Test
function LoadScheduledTest() {
    $.ajax({
        url: API + "/alltest/scheduled",
        method: "GET",
        success: function (data) {

            $("#heading").text("Active Users");
            $("#topTenTable").empty();

            data.forEach(test => {
                $("#topTenTable").append(`
                    <tr class="border-b">
                        <td class="p-3">${test.testName}</td>
                        <td class="p-3">${test.subjectname}</td>
                        <td class="p-3">${test.duration}</td>
                        <td class="p-3">${test.scheduledStart}</td>
                        <td class="p-3">${test.scheduledEnd}</td>
                    </tr>
                `);
            });
        }
    });
}

// Load Cancelled Test
function loadCancelledTest() {
    $.ajax({
        url: API + "/alltest/cancelled",
        method: "GET",
        success: function (data) {

            $("#heading").text("Cancelled Tests");
            $("#topTenTable").empty();

            data.forEach(test => {
                $("#topTenTable").append(`
                    <tr class="border-b">
                        <td class="p-3">${test.testName}</td>
                        <td class="p-3">${test.subjectname}</td>
                        <td class="p-3">${test.duration}</td>
                        <td class="p-3">${test.scheduledStart}</td>
                        <td class="p-3">${test.scheduledEnd}</td>
                    </tr>
                `);
            });
        }
    });
}
</script>

</body>
</html>
