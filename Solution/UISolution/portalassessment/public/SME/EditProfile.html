<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Customer Profile</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { poppins: ["Poppins", "sans-serif"] }
        }
      }
    }
  </script>
</head>

<body class="bg-gradient-to-br from-blue-100 to-blue-200 font-poppins">

  <div class="max-w-3xl mx-auto mt-16 bg-white rounded-xl p-8 shadow-lg">

    <!-- Profile Header -->
    <div class="text-center mb-6">
      <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"
        alt="User Avatar" class="w-28 h-28 rounded-full object-cover border-4 border-blue-900 mx-auto" />
      <h3 id="profileName" class="text-blue-900 font-semibold mt-4 text-2xl"></h3>
      <p id="profileRole" class="text-gray-500 mt-1">User Role: subject matter expert</p>
    </div>

    <!-- Profile Form -->
    <form id="editProfileForm" class="space-y-6">

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <div>
          <label class="font-semibold text-gray-800 block mb-1">Aadhar ID</label>
          <input type="text" id="profileAadhar"
            class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>

        <div>
          <label class="font-semibold text-gray-800 block mb-1">First Name</label>
          <input type="text" id="profileFirstName"
            class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>

        <div>
          <label class="font-semibold text-gray-800 block mb-1">Last Name</label>
          <input type="text" id="profileLastName"
            class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>

        <div>
          <label class="font-semibold text-gray-800 block mb-1">Email</label>
          <input type="email" id="profileEmail" readonly
            class="w-full border border-gray-300 rounded-md bg-gray-100 px-3 py-2 text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>

        <div>
          <label class="font-semibold text-gray-800 block mb-1">Contact Number</label>
          <input type="text" id="profileContact"
            class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>

      </div>

      <div class="text-center">
        <button type="button" id="editBtn"
          class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-lg transition"
          onclick="toggleEdit()">Update Profile</button>
      </div>
    </form>

  </div>

  <script>
    const userProfileIdData = localStorage.getItem("userId");

    $(document).ready(function () {
      $.ajax({
        url: `http://localhost:5238/api/UserProfile/${userProfileIdData}`,
        method: "GET",
        success: function (data) {
          if (!data) {
            alert("Profile Not Found!!");
            return;
          }

          $("#profileFirstName").val(data.firstname);
          $("#profileLastName").val(data.lastname);
          $("#profileAadhar").val(data.aadharId);
          $("#profileEmail").val(data.email);
          $("#profileContact").val(data.contactNumber);
          $("#profileName").text(`${data.firstname} ${data.lastname}`);
        },
        error: function (xhr, status, error) {
          console.error("Error fetching profile:", error);
        },
      });
    });

    function toggleEdit() {
      const updatedData = {
        id: userProfileIdData,
        aadharId: $("#profileAadhar").val(),
        firstname: $("#profileFirstName").val(),
        lastname: $("#profileLastName").val(),
        contactNumber: $("#profileContact").val(),
        email: $("#profileEmail").val(),
        password: "",
      };

      $.ajax({
        url: `http://localhost:5238/api/UserProfile/${userProfileIdData}`,
        method: "PUT",
        contentType: "application/json",
        data: JSON.stringify(updatedData),
        success: function (response) {
          if (response == false) {
            alert("Profile Not Edited!!");
          } else {
            alert("Data edited successfully");
            $("#content").load("profile.html");
          }
        },
        error: function (xhr, status, error) {
          console.error("Error updating profile:", error);
        },
      });
    }
  </script>

</body>

</html>
