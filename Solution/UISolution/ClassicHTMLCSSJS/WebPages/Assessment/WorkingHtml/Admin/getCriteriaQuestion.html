<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subject Question Bank</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
      .subject-tabs,
      .criteria-tabs {
        display: flex;
        gap: 12px;
        overflow-x: auto;
        padding: 10px 0;
        white-space: nowrap;
      }

      .subject-tab,
      .criteria-tab {
        cursor: pointer;
        padding: 10px 18px;
        border-radius: 20px;
        background: #e9ecef;
        transition: 0.3s;
        font-size: 15px;
        font-weight: 500;
      }

      .subject-tab:hover,
      .criteria-tab:hover {
        background: #d1dce4;
      }

      .subject-tab.active {
        background: #0d6efd;
        color: white;
      }

      .criteria-tab.activeCriteria {
        background: #0d6efd;
        color: white;
      }

      .question-card {
        padding: 12px;
        border-radius: 10px;
        background: #ffffff;
        box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 10px;
      }
    </style>
  </head>

  <body class="bg-light">
    <div class="container mt-4">
      <h2 class="text-center mb-4">Subject Question Bank</h2>

      <!-- SUBJECT TABS -->
      <div id="subjectsTabs" class="subject-tabs mb-4"></div>

      <!-- CRITERIA TABS -->
      <div id="criteriasTabs" class="criteria-tabs mb-3"></div>

      <!-- TITLE -->
      <h4 id="criteriaTitle" class="mb-3 text-primary fw-bold">
        Select a subject
      </h4>

      <!-- QUESTIONS -->
      <div id="questionList"></div>
    </div>

    <script>
       SUBJECT_API = "http://localhost:5238/api/QuestionBank/questionCount";

      $(document).ready(function () {
        loadSubjects();
      });

      // --------------------------- LOAD SUBJECTS ---------------------------

      function loadSubjects() {
        $.ajax({
          url: SUBJECT_API,
          method: "GET",
          success: function (subjects) {
            $("#subjectsTabs").empty();

            subjects.forEach((sub) => {
              let tab = $(`
                <div class="subject-tab">
                  ${sub.subject.title} (${sub.questionCount})
                </div>
              `);

              tab.click(function () {
                $(".subject-tab").removeClass("active");
                $(this).addClass("active");

                loadCriteria(sub.subject.id, sub.subject.title);
                $("#criteriaTitle").text(`Select criteria for: ${sub.subject.title}`);
              });

              $("#subjectsTabs").append(tab);
            });
          },
          error: function () {
            alert("Failed to load subjects");
          },
        });
      }

      // --------------------------- LOAD CRITERIA ---------------------------
function loadCriteria(subjectId, subjectName) {
     CRITERIA_API = `http://localhost:5238/api/criteria/${subjectId}`;

    $.ajax({
        url: CRITERIA_API,
        method: "GET",
        success: function (criteria) {
            $("#criteriasTabs").empty();
            $("#questionList").empty();
            $("#criteriaTitle").text(`Criteria for: ${subjectName}`);

            // ‚ùó If NO criteria found
            if (!criteria || criteria.length === 0) {
                $("#criteriasTabs").html(`
                    <div class="text-danger fw-bold">No criteria available for this subject.</div>
                `);

                return;
            }

            // If criteria exists
            criteria.forEach((c) => {
                let tab = $(`
                    <div class="criteria-tab">${c.title}</div>
                `);

                tab.click(function () {
                    $(".criteria-tab").removeClass("activeCriteria");
                    $(this).addClass("activeCriteria");

                    loadQuestions(subjectId, c.id, c.title);
                });

                $("#criteriasTabs").append(tab);
            });
        },
        error: function () {
            alert("Failed to load criteria");
        },
    });
}


      // --------------------------- LOAD QUESTIONS ---------------------------

      function loadQuestions(subjectId, criteriaId, criteriaTitle) {
         QUESTION_API = `http://localhost:5238/api/questionbank/questions/subjects/${subjectId}/criterias/${criteriaId}`;

        $.ajax({
          url: QUESTION_API,
          method: "GET",
          success: function (questions) {
            $("#criteriaTitle").text(`${criteriaTitle} - Question Bank`);
            $("#questionList").empty();

            if (!questions || questions.length === 0) {
              $("#questionList").html("<p>No questions available.</p>");
              return;
            }

            let i = 1;
            questions.forEach((q) => {
              let card = $(`
                <div class="question-card" onclick="QuestionDisplay(${q.questionId})">
                  <strong>Q ${i}: ${q.question}</strong>
                </div>
              `);
              i++;

              $("#questionList").append(card);
            });
          },
           error: function () {
            $("#questionList").html(`
                <div class="p-3 mt-2 text-center text-danger fw-bold" 
                     style="background:#ffe6e6;border-radius:10px;">
                    Error loading questions.
                </div>
            `);
        },
    });
      }

      // --------------------------- LOAD QUESTION DETAILS ---------------------------

      function QuestionDisplay(questionId) {
        alert("Open details page for Question ID: " + questionId);
      }
    </script>
  </body>
</html>
