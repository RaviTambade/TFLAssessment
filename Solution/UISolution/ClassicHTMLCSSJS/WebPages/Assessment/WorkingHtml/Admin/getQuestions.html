<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subject Question Bank</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
      /* Horizontal Tab Styles */
      .subject-tabs {
        display: flex;
        gap: 12px;
        overflow-x: auto;
        padding: 10px 0;
        white-space: nowrap;
      }

      .subject-tab {
        cursor: pointer;
        padding: 10px 18px;
        border-radius: 20px;
        background: #e9ecef;
        transition: 0.3s;
        font-size: 15px;
        font-weight: 500;
      }

      .subject-tab:hover {
        background: #d1dce4;
      }

      .subject-tab.active {
        background: #0d6efd;
        color: white;
      }

      .question-card {
        padding: 12px;
        border-radius: 10px;
        background: #ffffff;
        box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 10px;
      }
    </style>
  </head>

  <body class="bg-light">
    <div class="container mt-4">
      <h2 class="text-center mb-4">Subject Question Bank</h2>

      <!-- HORIZONTAL SUBJECT TABS -->
      <div id="subjectsTabs" class="subject-tabs mb-4"></div>

      <!-- SUBJECT NAME -->
      <h4 id="subjectTitle" class="mb-3 text-primary fw-bold">
        Select a subject
      </h4>

      <!-- QUESTION LIST -->
      <div id="questionList"></div>
    </div>

    <script>
      // API for subject list
      SUBJECT_API = "http://localhost:5238/api/QuestionBank/questionCount";

      $(document).ready(function () {
        loadSubjects();
      });

      function loadSubjects() {
        $.ajax({
          url: SUBJECT_API,
          method: "GET",
          success: function (subjects) {
            $("#subjectsTabs").empty();

            subjects.forEach((sub) => {
              let tab = $(`
                    <div class="subject-tab">
                        ${sub.subject.title} (${sub.questionCount})
                    </div>
                `);

              tab.click(function () {
                $(".subject-tab").removeClass("active");
                $(this).addClass("active");

                loadQuestions(sub.subject.id, sub.subject.title);
              });

              $("#subjectsTabs").append(tab);
            });
          },
          error: function () {
            alert("Failed to load subjects");
          },
        });
      }

      function loadQuestions(subjectId, subjectName) {
        QUESTION_API = `http://localhost:5238/api/questionbank/questions/subjects/${subjectId}`;

        $.ajax({
          url: QUESTION_API,
          method: "GET",
          success: function (questions) {
            $("#subjectTitle").text(`${subjectName} - Question Bank`);
            $("#questionList").empty();

            if (!questions || questions.length === 0) {
              $("#questionList").html("<p>No questions available.</p>");
              return;
            }

           let i = 1;
            questions.forEach((q) => {
              let card = $(`
                    <div class="question-card" onclick="QuestionDisplay(${q.questionId})">
                        <strong>Q ${i}: ${q.question}</strong>
                    </div>
                `);
              i++;

              $("#questionList").append(card);
            });
          },
          error: function () {
            alert("Failed to load question bank");
          },
        });
      }

      function QuestionDisplay(questionId) {
        $("#content").load("QuestionDetails.html", function () {
          QuestionDetails(questionId);
        });
      }
    </script>
  </body>
</html>
